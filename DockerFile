FROM python:3.12-slim

# Set working directory
WORKDIR /app

# Install pip tools
RUN pip install --upgrade pip

# Copy only pyproject.toml and README first for dependency resolution
COPY pyproject.toml README.md ./

# Install hatch and then install your project dependencies
RUN pip install hatchling

# Install your project (this will read dependencies from pyproject.toml)
RUN pip install .

# Now copy the rest of the code
COPY . .

# Expose the API port
EXPOSE 8000

ENV PYTHONPATH=/app/src
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
